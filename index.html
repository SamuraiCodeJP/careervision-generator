<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚­ãƒ£ãƒªã‚¢æ”¯æ´Webã‚½ãƒ•ãƒˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: sans-serif; }
        .app-container { max-width: 650px; margin: 30px auto; padding: 25px; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .character-bubble { background: #fff0f5; border: 2px solid #ffb6c1; border-radius: 15px; padding: 15px; margin-bottom: 25px; position: relative; }
        .hidden { display: none !important; }
        .form-label { font-weight: bold; color: #444; font-size: 0.9rem; margin-top: 10px; }
        .btn-option { padding: 12px; border-radius: 12px; font-weight: bold; transition: 0.3s; }
        .result-box { background: #f8f9fa; border: 1px solid #ddd; padding: 20px; border-radius: 10px; white-space: pre-wrap; line-height: 1.8; }
    </style>
</head>
<body>

<div class="container">
    <div class="app-container">
        <div class="character-bubble" id="main-msg"></div>

        <div id="step-s1" class="hidden">
            <div class="d-grid gap-3">
                <button onclick="startPR()" class="btn btn-outline-primary p-4 btn-option">âœ¨ è‡ªå·±PRã‚’ä½œæˆã™ã‚‹</button>
                <button class="btn btn-outline-secondary p-4 btn-option" disabled>ğŸš€ å¿—æœ›å‹•æ©Ÿï¼ˆæº–å‚™ä¸­ï¼‰</button>
            </div>
        </div>

        <div id="pr-step1" class="hidden">
            <div class="mb-3">
                <label class="form-label">ä¸€ç•ªåŠ›ã‚’å…¥ã‚ŒãŸã“ã¨</label>
                <input type="text" class="form-control" id="q1" placeholder="ã‚µãƒ¼ã‚¯ãƒ«ã€ã‚¢ãƒ«ãƒã‚¤ãƒˆã€å­¦æ¥­ãªã©">
                <label class="form-label">åŠ›ã‚’æ³¨ã”ã†ã¨æ€ã£ãŸç†ç”±</label>
                <input type="text" class="form-control" id="q2" placeholder="å°†æ¥ã®ãŸã‚ã€å¿…è¦ãªè²»ç”¨ã‚’ç¨¼ããŸã„ãªã©">
                <label class="form-label">ã¯ã˜ã‚ãŸå½“åˆã®ä¸å®‰</label>
                <input type="text" class="form-control" id="q3" placeholder="æ¥å®¢ã§ãã‚‹ã‹ä¸å®‰ãªã©">
                <label class="form-label">ä¸å®‰ã«å¯¾ã—ã¦åŠªåŠ›ã—ãŸã“ã¨</label>
                <input type="text" class="form-control" id="q4" placeholder="å…ˆè¼©ã®è¨€å‹•ã‚’çœŸä¼¼ã—ãŸãªã©">
            </div>
            <button onclick="showPage('pr-step2')" class="btn btn-primary w-100 btn-option">æ¬¡ã¸ï¼ˆ2/3ï¼‰</button>
        </div>

        <div id="pr-step2" class="hidden">
            <div class="mb-3">
                <label class="form-label">æ…£ã‚Œã¦ãã¦ã‹ã‚‰è¨­å®šã—ãŸç›®æ¨™</label>
                <input type="text" class="form-control" id="q5" placeholder="å®¢ã‚’ç¬‘é¡”ã«ã™ã‚‹ã€é‹å–¶ã«è²¢çŒ®ãªã©">
                <label class="form-label">ç”Ÿã˜ãŸå•é¡Œï¼ˆå¤±æ•—ãƒ»è‹¦åŠ´ãƒ»å›°é›£ï¼‰</label>
                <textarea class="form-control" id="q6" rows="2" placeholder="æ„è¦‹ã®è¡çªã§ã‚µãƒ¼ã‚¯ãƒ«ãŒåˆ†è£‚ã—ã‹ã‘ãŸãªã©"></textarea>
                <label class="form-label">å•é¡Œã®åŸå› </label>
                <input type="text" class="form-control" id="q7" placeholder="é¸è€ƒåŸºæº–ãŒæ›–æ˜§ã ã£ãŸãªã©">
                <label class="form-label">å•é¡Œã«å¯¾ã™ã‚‹ã‚ãªãŸã®è¡Œå‹•</label>
                <textarea class="form-control" id="q8" rows="2" placeholder="èª¿åœã—ã‚ˆã†ã¨åŠªåŠ›ã—ãŸãªã©"></textarea>
                <label class="form-label">å•é¡Œå…‹æœã®ãŸã‚å‰µæ„å·¥å¤«</label>
                <input type="text" class="form-control" id="q9" placeholder="ç‹¬è‡ªã®è©•ä¾¡ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ãŸãªã©">
            </div>
            <div class="d-flex gap-2">
                <button onclick="showPage('pr-step1')" class="btn btn-secondary w-50 btn-option">æˆ»ã‚‹</button>
                <button onclick="showPage('pr-step3')" class="btn btn-primary w-50 btn-option">æ¬¡ã¸ï¼ˆ3/3ï¼‰</button>
            </div>
        </div>

        <div id="pr-step3" class="hidden">
            <div class="mb-3">
                <label class="form-label">å•é¡Œã‚’æŒ¯ã‚Šè¿”ã£ã¦å¾—ãŸå­¦ã³</label>
                <input type="text" class="form-control" id="q10" placeholder="æ ¹å›ã—ã‚„æ„è¦‹ã‚’ããã“ã¨ãŒé‡è¦ãªã©">
                <label class="form-label">å¾—ãŸæˆé•·ã‚„è‡ªä¿¡</label>
                <input type="text" class="form-control" id="q11" placeholder="ä¸–ä»£ã®é•ã†äººã¨è©±ã›ã‚‹ã‚ˆã†ã«ãªã£ãŸãªã©">
                <label class="form-label">å…·ä½“çš„ãªæˆæœ</label>
                <input type="text" class="form-control" id="q12" placeholder="ãƒ™ã‚¹ãƒˆ8å…¥ã‚Šã€æ™‚çµ¦ã‚¢ãƒƒãƒ—ãªã©">
                <label class="form-label">ä¸€ç•ªå¬‰ã—ã‹ã£ãŸè¤’ã‚è¨€è‘‰</label>
                <input type="text" class="form-control" id="q13" placeholder="ã€Œã„ã¦ãã‚Œã¦å¿ƒå¼·ã„ã‚ˆã€ãªã©">
                <hr>
                <label class="form-label text-primary">â˜…èª²é¡Œã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¿…é ˆï¼‰</label>
                <input type="text" class="form-control border-primary" id="q-title" placeholder="ä¾‹ï¼šæœ€å¤§ã®å£ã‚’ã©ã†ä¹—ã‚Šè¶ŠãˆãŸã‹ï¼Ÿ">
            </div>
            <div class="d-flex gap-2">
                <button onclick="showPage('pr-step2')" class="btn btn-secondary w-50 btn-option">æˆ»ã‚‹</button>
                <button onclick="handleGenerate()" class="btn btn-success w-50 btn-option">âœ¨ ç”Ÿæˆã™ã‚‹</button>
            </div>
        </div>

        <div id="step-result" class="hidden">
            <div class="result-box mb-3" id="result-text"></div>
            <div class="d-grid gap-2">
                <button onclick="showPage('pr-step3')" class="btn btn-outline-primary btn-option">èª²é¡Œãƒã‚§ãƒ³ã‚¸ï¼ˆå†…å®¹ä¿æŒï¼‰</button>
                <button onclick="location.reload()" class="btn btn-secondary btn-option">æˆ»ã‚‹ï¼ˆæœ€åˆã‹ã‚‰ï¼‰</button>
            </div>
        </div>
    </div>
</div>

<script>
    const ADMIN_KEY = AIzaSyBgJNO7o9oov4ZpsRYxbhs0DFGoYZMEGJw; // â˜…ã“ã“ã«è‡ªåˆ†ã®APIã‚­ãƒ¼ã‚’å…¥ã‚Œã‚‹
    const LIMIT = 5;

    function showPage(id, customMsg) {
        document.querySelectorAll('.app-container > div:not(.character-bubble)').forEach(el => el.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(customMsg) document.getElementById('main-msg').innerText = customMsg;
    }

    function startPR() {
        const name = localStorage.getItem('userName');
        showPage('pr-step1', `ã€Œã¯ã„ã€${name}ã•ã‚“ã®è‡ªå·±PRç”Ÿæˆã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ã­ã€‚ã¾ãšã¯åŸºæœ¬æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„ã€`);
    }

    async function handleGenerate() {
        const title = document.getElementById('q-title').value;
        if(!title) return alert("ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

        const count = parseInt(localStorage.getItem('usageCount') || "0");
        let key = ADMIN_KEY;

        if (count >= LIMIT) {
            key = prompt("ãŠè©¦ã—5å›ã‚’è¶…ãˆã¾ã—ãŸã€‚ã”è‡ªèº«ã®Gemini APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            if(!key) return;
        }

        document.getElementById('main-msg').innerText = "ã€ŒAIãŒä¸€ç”Ÿæ‡¸å‘½è€ƒãˆã¦ã„ã¾ã™ã€‚å°‘ã—ã ã‘å¾…ã£ã¦ãã ã•ã„ã­â€¦ã€";
        
        const promptText = `ä»¥ä¸‹ã®æƒ…å ±ã‚’å…ƒã«ã€å°±æ´»ç”¨ã®è‡ªå·±PRã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
        ãƒ«ãƒ¼ãƒ«ï¼šã§ã™ã¾ã™èª¿ã€çµè«–å…ˆè¡Œã€ç§ã‚’å¤šç”¨ã—ãªã„ã€è‹¦åŠ´ã—ãŸå¿ƒæƒ…ã‚’å…¥åŠ›ã‹ã‚‰é¡æ¨ã—ã¦å«ã‚ã‚‹ã€ä»–è€…ã®è¤’ã‚è¨€è‘‰ã‚’ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã«åŠ ãˆã‚‹ã€‚400æ–‡å­—ç¨‹åº¦ã€‚
        ã€èª²é¡Œã€‘${title}
        ã€å†…å®¹ã€‘åŠ›ã‚’å…¥ã‚ŒãŸã“ã¨ï¼š${document.getElementById('q1').value}ã€èƒŒæ™¯ï¼š${document.getElementById('q2').value}ã€
        ä¸å®‰ï¼š${document.getElementById('q3').value}ã€åŠªåŠ›ï¼š${document.getElementById('q4').value}ã€ç›®æ¨™ï¼š${document.getElementById('q5').value}ã€
        å›°é›£ï¼š${document.getElementById('q6').value}ã€åŸå› ï¼š${document.getElementById('q7').value}ã€è¡Œå‹•ï¼š${document.getElementById('q8').value}ã€
        å·¥å¤«ï¼š${document.getElementById('q9').value}ã€å­¦ã³ï¼š${document.getElementById('q10').value}ã€æˆé•·ï¼š${document.getElementById('q11').value}ã€
        æˆæœï¼š${document.getElementById('q12').value}ã€è¤’ã‚è¨€è‘‰ï¼š${document.getElementById('q13').value}`;

        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                method: "POST",
                body: JSON.stringify({ contents: [{ parts: [{ text: promptText }] }] })
            });
            const data = await res.json();
            const result = data.candidates[0].content.parts[0].text;
            
            localStorage.setItem('usageCount', count + 1);
            document.getElementById('result-text').innerText = result;
            showPage('step-result', `ã€Œ${localStorage.getItem('userName')}ã•ã‚“ã€ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ç´å¾—ã®ã„ãæ–‡ç« ã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿã€`);
        } catch (e) {
            document.getElementById('main-msg').innerText = "ã€Œã‚¸ã‚§ãƒŸãƒ‹ãŒç–²ã‚Œæœã¦ã¾ã—ãŸâ€¦ã€‚å°‘ã—æ™‚é–“ã‚’ç½®ã„ã¦ãã ã•ã„ã€";
        }
    }

    window.onload = () => {
        const name = localStorage.getItem('userName');
        if(name) {
            showPage('step-s1', `ã€Œ${name}ã•ã‚“ã€ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€`);
        } else {
            // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼ˆçœç•¥ã—ã¦ã„ã‚‹ãŒæœ¬æ¥ã¯ã“ã“ã§ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å–å¾—ï¼‰
            location.href = "index.html"; 
        }
    };
</script>
</body>
</html>
