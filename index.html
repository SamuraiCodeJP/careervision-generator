<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚­ãƒ£ãƒªã‚¢æ”¯æ´Webã‚½ãƒ•ãƒˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: sans-serif; }
        .app-container { max-width: 650px; margin: 30px auto; padding: 25px; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .character-bubble { background: #fff0f5; border: 2px solid #ffb6c1; border-radius: 15px; padding: 15px; margin-bottom: 25px; position: relative; color: #444; }
        .character-bubble::after { content: ''; position: absolute; bottom: -10px; left: 30px; border-width: 10px 10px 0; border-style: solid; border-color: #ffb6c1 transparent; }
        .hidden { display: none !important; }
        .form-label { font-weight: bold; color: #444; font-size: 0.9rem; margin-top: 15px; }
        .btn-option { padding: 12px; border-radius: 12px; font-weight: bold; transition: 0.3s; }
        .auto-resize { overflow: hidden; resize: none; min-height: 45px; transition: height 0.2s; }
        .result-box { background: #f8f9fa; border: 1px solid #ddd; padding: 20px; border-radius: 10px; white-space: pre-wrap; line-height: 1.8; }
    </style>
</head>
<body>

<div class="container">
    <div class="app-container">
        <div class="character-bubble" id="main-msg"></div>

        <div id="step-s1" class="hidden text-center">
            <div class="d-grid gap-3">
                <button onclick="startPR()" class="btn btn-outline-primary p-4 btn-option">âœ¨ è‡ªå·±PRã‚’ä½œæˆã™ã‚‹</button>
                <button class="btn btn-outline-secondary p-4 btn-option" disabled>ğŸš€ å¿—æœ›å‹•æ©Ÿï¼ˆæº–å‚™ä¸­ï¼‰</button>
            </div>
        </div>

        <div id="pr-step1" class="hidden">
            <label class="form-label">ä¸€ç•ªåŠ›ã‚’å…¥ã‚ŒãŸã“ã¨</label>
            <textarea class="form-control auto-resize" id="q1" rows="1"></textarea>
            <label class="form-label">åŠ›ã‚’æ³¨ã”ã†ã¨æ€ã£ãŸç†ç”±</label>
            <textarea class="form-control auto-resize" id="q2" rows="1"></textarea>
            <label class="form-label">ã¯ã˜ã‚ãŸå½“åˆã®ä¸å®‰</label>
            <textarea class="form-control auto-resize" id="q3" rows="1"></textarea>
            <label class="form-label">ä¸å®‰ã«å¯¾ã—ã¦åŠªåŠ›ã—ãŸã“ã¨</label>
            <textarea class="form-control auto-resize" id="q4" rows="1"></textarea>
            <button onclick="showPage('pr-step2', getCharMsg(2))" class="btn btn-primary w-100 btn-option mt-4">æ¬¡ã¸ï¼ˆ2/3ï¼‰</button>
        </div>

        <div id="pr-step2" class="hidden">
            <label class="form-label">æ…£ã‚Œã¦ãã¦ã‹ã‚‰è¨­å®šã—ãŸç›®æ¨™</label>
            <textarea class="form-control auto-resize" id="q5" rows="1"></textarea>
            <label class="form-label">ç”Ÿã˜ãŸå•é¡Œï¼ˆå¤±æ•—ãƒ»è‹¦åŠ´ãƒ»å›°é›£ï¼‰</label>
            <textarea class="form-control auto-resize" id="q6" rows="1"></textarea>
            <label class="form-label">å•é¡Œã®åŸå› </label>
            <textarea class="form-control auto-resize" id="q7" rows="1"></textarea>
            <label class="form-label">å•é¡Œã«å¯¾ã™ã‚‹ã‚ãªãŸã®è¡Œå‹•</label>
            <textarea class="form-control auto-resize" id="q8" rows="1"></textarea>
            <label class="form-label">å•é¡Œå…‹æœã®ãŸã‚å‰µæ„å·¥å¤«</label>
            <textarea class="form-control auto-resize" id="q9" rows="1"></textarea>
            <div class="d-flex gap-2 mt-4">
                <button onclick="showPage('pr-step1', getCharMsg(1))" class="btn btn-secondary w-50 btn-option">æˆ»ã‚‹</button>
                <button onclick="showPage('pr-step3', getCharMsg(3))" class="btn btn-primary w-50 btn-option">æ¬¡ã¸ï¼ˆ3/3ï¼‰</button>
            </div>
        </div>

        <div id="pr-step3" class="hidden">
            <label class="form-label">å•é¡Œã‚’æŒ¯ã‚Šè¿”ã£ã¦å¾—ãŸå­¦ã³</label>
            <textarea class="form-control auto-resize" id="q10" rows="1"></textarea>
            <label class="form-label">å¾—ãŸæˆé•·ã‚„è‡ªä¿¡</label>
            <textarea class="form-control auto-resize" id="q11" rows="1"></textarea>
            <label class="form-label">å…·ä½“çš„ãªæˆæœ</label>
            <textarea class="form-control auto-resize" id="q12" rows="1"></textarea>
            <label class="form-label">ä¸€ç•ªå¬‰ã—ã‹ã£ãŸè¤’ã‚è¨€è‘‰</label>
            <textarea class="form-control auto-resize" id="q13" rows="1"></textarea>
            <hr>
            <label class="form-label text-primary font-weight-bold">â˜…èª²é¡Œã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¿…é ˆï¼‰</label>
            <textarea class="form-control border-primary auto-resize" id="q-title" rows="1" placeholder="ä¾‹ï¼šæœ€å¤§ã®å£ã‚’ã©ã†ä¹—ã‚Šè¶ŠãˆãŸã‹ï¼Ÿ"></textarea>
            <div class="d-flex gap-2 mt-4">
                <button onclick="showPage('pr-step2', getCharMsg(2))" class="btn btn-secondary w-50 btn-option">æˆ»ã‚‹</button>
                <button onclick="handleGenerate()" class="btn btn-success w-50 btn-option">âœ¨ ç”Ÿæˆã™ã‚‹</button>
            </div>
        </div>

        <div id="step-result" class="hidden">
            <div class="result-box mb-3" id="result-text"></div>
            <div class="d-grid gap-2">
                <button onclick="showPage('pr-step3', getCharMsg(3))" class="btn btn-outline-primary btn-option">èª²é¡Œãƒã‚§ãƒ³ã‚¸ï¼ˆå†…å®¹ä¿æŒï¼‰</button>
                <button onclick="location.reload()" class="btn btn-secondary btn-option">æˆ»ã‚‹ï¼ˆæœ€åˆã‹ã‚‰ï¼‰</button>
            </div>
        </div>
    </div>
</div>

<script>
    const ADMIN_KEY = "AIzaSyBgJNO7o9oov4ZpsRYxbhs0DFGoYZMEGJw"; // â˜…ã“ã“ã«è‡ªåˆ†ã®APIã‚­ãƒ¼ã‚’è²¼ã£ã¦ãã ã•ã„
    const LIMIT = 5;

    function getCharMsg(step) {
        const name = localStorage.getItem('userName') || "ã‚ãªãŸ";
        if(step === 1) return `ã€Œã¯ã„ã€${name}ã•ã‚“ã®è‡ªå·±PRç”Ÿæˆã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ã­ã€‚ã¾ãšã¯åŸºæœ¬æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„ã€`;
        if(step === 2) return `ã€Œæ¬¡ã«ã€${name}ã•ã‚“ãŒã¶ã¤ã‹ã£ãŸå£ã‚„ã€ãã‚Œã‚’ã©ã†ä¹—ã‚Šè¶ŠãˆãŸã‹ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€`;
        if(step === 3) return `ã€ŒãŠç–²ã‚Œæ§˜ã§ã™ã€${name}ã•ã‚“ã®è‡ªå·±PRç”Ÿæˆã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ã­ã€‚æœ€å¾Œã«ã€ä½“é¨“ã‹ã‚‰å¾—ãŸã“ã¨ã‚’æ•™ãˆã¦ä¸‹ã•ã„ã€`;
        return `ã€Œ${name}ã•ã‚“ã€ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€`;
    }

    function showPage(id, msg) {
        document.querySelectorAll('.app-container > div:not(.character-bubble)').forEach(el => el.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(msg) document.getElementById('main-msg').innerText = msg;
    }

    function startPR() { showPage('pr-step1', getCharMsg(1)); }

    // ã‚ªãƒ¼ãƒˆãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½
    document.addEventListener('input', function (e) {
        if (e.target.classList.contains('auto-resize')) {
            e.target.style.height = 'auto';
            e.target.style.height = e.target.scrollHeight + 'px';
        }
    });

    async function handleGenerate() {
        const title = document.getElementById('q-title').value.trim();
        if(!title) return alert("ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

        const count = parseInt(localStorage.getItem('usageCount') || "0");
        let key = ADMIN_KEY;
        if (count >= LIMIT) {
            key = prompt("ãŠè©¦ã—å›æ•°ã‚’è¶…ãˆã¾ã—ãŸã€‚ã”è‡ªèº«ã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            if(!key) return;
        }

        document.getElementById('main-msg').innerText = "ã€ŒAIãŒä¸€ç”Ÿæ‡¸å‘½è€ƒãˆã¦ã„ã¾ã™ã€‚å°‘ã—ã ã‘å¾…ã£ã¦ãã ã•ã„ã­â€¦ã€";
        
        const pText = `ä»¥ä¸‹ã®æƒ…å ±ã‚’å…ƒã«ã€å°±æ´»ç”¨ã®è‡ªå·±PRã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
        ãƒ«ãƒ¼ãƒ«ï¼šã§ã™ã¾ã™èª¿ã€çµè«–å…ˆè¡Œã€ç§ã‚’å¤šç”¨ã—ãªã„ã€è‹¦åŠ´ã—ãŸå¿ƒæƒ…ã‚’å…¥åŠ›ã‹ã‚‰é¡æ¨ã—ã¦å«ã‚ã‚‹ã€ä»–è€…ã®è¤’ã‚è¨€è‘‰ã‚’ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã«åŠ ãˆã‚‹ã€‚400æ–‡å­—ç¨‹åº¦ã€‚
        èª²é¡Œï¼š${title} / å†…å®¹ï¼š${document.getElementById('q1').value} / èƒŒæ™¯ï¼š${document.getElementById('q2').value} / ä¸å®‰ï¼š${document.getElementById('q3').value} / åŠªåŠ›ï¼š${document.getElementById('q4').value} / ç›®æ¨™ï¼š${document.getElementById('q5').value} / å›°é›£ï¼š${document.getElementById('q6').value} / åŸå› ï¼š${document.getElementById('q7').value} / è¡Œå‹•ï¼š${document.getElementById('q8').value} / å·¥å¤«ï¼š${document.getElementById('q9').value} / å­¦ã³ï¼š${document.getElementById('q10').value} / æˆé•·ï¼š${document.getElementById('q11').value} / æˆæœï¼š${document.getElementById('q12').value} / è¤’ã‚è¨€è‘‰ï¼š${document.getElementById('q13').value}`;

        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
            const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: pText }] }] })
            });

            if (!response.ok) {
                const errData = await response.json();
                console.error("API Error:", errData);
                throw new Error("API_ERROR");
            }

            const data = await response.json();
            const result = data.candidates[0].content.parts[0].text;
            
            localStorage.setItem('usageCount', count + 1);
            document.getElementById('result-text').innerText = result;
            showPage('step-result', `ã€Œ${localStorage.getItem('userName')}ã•ã‚“ã€ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ç´å¾—ã®ã„ãæ–‡ç« ã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿã€`);
        } catch (e) {
            console.error("Fetch Error:", e);
            document.getElementById('main-msg').innerText = "ã€Œã‚¸ã‚§ãƒŸãƒ‹ãŒåŠ›å°½ãã¾ã—ãŸ(ç¬‘) APIã‚­ãƒ¼ãŒæ­£ã—ã„ã‹ç¢ºèªã™ã‚‹ã‹ã€å°‘ã—æ™‚é–“ã‚’ç½®ã„ã¦ã‹ã‚‰å†æŒ‘æˆ¦ã—ã¦ãã ã•ã„ã­ã€";
        }
    }

    window.onload = () => {
        const name = localStorage.getItem('userName');
        if(name) { showPage('step-s1', getCharMsg(0)); } 
        else { location.reload(); }
    };
</script>
</body>
</html>
