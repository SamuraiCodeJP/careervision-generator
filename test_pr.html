<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>API疎通テスト画面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .test-container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        pre { white-space: pre-wrap; background: #eee; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="test-container">
    <h3>API 動作テスト</h3>
    <p>以下の固定ネタで自己PRを生成します。</p>
    
    <div class="card mb-3">
        <div class="card-body">
            <strong>テスト用データ:</strong><br>
            座右の銘：山は成長しないが、私は成長できる<br>
            シーン：資格試験<br>
            長所：計画性が身に付いた
        </div>
    </div>

    <button id="testBtn" onclick="runTest()" class="btn btn-primary w-100">テスト生成を開始</button>

    <div id="resultArea" class="mt-4" style="display:none;">
        <h5>生成結果:</h5>
        <div id="resultText" class="alert alert-info"></div>
    </div>
</div>

<script src="api-config.js"></script>
<script>
    async function runTest() {
        const btn = document.getElementById('testBtn');
        const resArea = document.getElementById('resultArea');
        const resText = document.getElementById('resultText');

        btn.disabled = true;
        btn.innerText = "生成中...";
        resArea.style.display = "block";
        resText.innerText = "Geminiに送信中...";

        // シゲルさんのプロンプトを構築
        const testPrompt = `
以下のネタをもとに、400文字程度の自己PRを作成してください。
優秀すぎる学生とならないように注意し、企業が求める「当事者意識」「改善姿勢」を盛り込んでください。

【作成ルール】
・「です、ます」調。
・「私」という言葉を極力使わない。
・座右の銘と行動指針を一致させる。

【ネタ】
座右の銘：山は成長しないが、私は成長できる
シーン：資格試験
辛かったこと：資格試験に挑戦したが不合格だった
努力：1日の隙間時間と毎日1時間の勉強時間を確保
努力2：日曜は本番と同じ時間で過去問を解く
努力3：同じテキストを繰り返し解き、理解を深めた
結果：半年後に合格
長所：計画性が身に付いた
`;

        try {
            // api-config.js の関数を呼び出す
            const result = await GeminiAPI.generateContent(testPrompt);
            
            if (result) {
                resText.innerText = result;
            } else {
                resText.innerText = "エラー：文章が空で返ってきました。API設定（ドメイン制限等）を見直してください。";
            }
        } catch (e) {
            resText.innerText = "エラーが発生しました: " + e.message;
        } finally {
            btn.disabled = false;
            btn.innerText = "テスト生成を開始";
        }
    }
</script>
</body>
</html>
